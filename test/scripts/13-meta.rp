# Decorator Tests
# Tests for decorator functionality (@desc, @title, @param, @arg, @required, etc.)

log "=== Decorator Tests ==="

# Prerequisite Tests: getMeta and setMeta commands
# These must work before decorator tests can run
log "=== Prerequisite: getMeta and setMeta Tests ==="

# Test 0.1: Basic setMeta for variables
log "Test 0.1: Basic setMeta for variables"
var $testVar01 100
setMeta $testVar01 description "A test variable"
setMeta $testVar01 version 1
test.assertEqual $testVar01 100 "testVar01 value should be 100"

# Test 0.2: Basic getMeta for variables (with key)
log "Test 0.2: Basic getMeta for variables (with key)"
getMeta $testVar01 description
test.assertEqual $ "A test variable" "getMeta with key failed for variable"
getMeta $testVar01 version
test.assertEqual $ 1 "getMeta version failed for variable"

# Test 0.3: Basic getMeta for variables (without key - all metadata)
log "Test 0.3: Basic getMeta for variables (without key)"
getMeta $testVar01
$allMeta01 = $
test.assertType $allMeta01 "object" "getMeta without key should return object"
test.assertEqual $allMeta01.description "A test variable" "getMeta all metadata - description failed"
test.assertEqual $allMeta01.version 1 "getMeta all metadata - version failed"

# Test 0.4: Basic setMeta for functions
log "Test 0.4: Basic setMeta for functions"
def testFn04
  log "Test function"
enddef
setMeta testFn04 description "A test function"
setMeta testFn04 author "Test Author"
testFn04

# Test 0.5: Basic getMeta for functions (with key)
log "Test 0.5: Basic getMeta for functions (with key)"
getMeta testFn04 description
test.assertEqual $ "A test function" "getMeta with key failed for function"
getMeta testFn04 author
test.assertEqual $ "Test Author" "getMeta author failed for function"

# Test 0.6: Basic getMeta for functions (without key - all metadata)
log "Test 0.6: Basic getMeta for functions (without key)"
getMeta testFn04
$allMeta06 = $
test.assertType $allMeta06 "object" "getMeta without key should return object for function"
test.assertEqual $allMeta06.description "A test function" "getMeta all metadata - description failed for function"
test.assertEqual $allMeta06.author "Test Author" "getMeta all metadata - author failed for function"

# Test 0.7: getMeta for non-existent metadata (should return null)
log "Test 0.7: getMeta for non-existent metadata"
var $testVar07 200
getMeta $testVar07 nonexistent
test.assertEqual $ null "getMeta for non-existent key should return null"
getMeta nonexistentFunction description
test.assertEqual $ null "getMeta for non-existent function should return null"

# Test 0.8: Updating existing metadata
log "Test 0.8: Updating existing metadata"
setMeta $testVar01 description "Updated description"
getMeta $testVar01 description
test.assertEqual $ "Updated description" "Updating metadata failed"
getMeta $testVar01 version
test.assertEqual $ 1 "Updating metadata should not affect other keys"

# Test 0.9: Using meta command (alias for setMeta)
log "Test 0.9: Using meta command (alias for setMeta)"
var $testVar09 300
meta $testVar09 description "Using meta command"
getMeta $testVar09 description
test.assertEqual $ "Using meta command" "meta command alias failed"

# Test 0.10: Multiple metadata keys
log "Test 0.10: Multiple metadata keys"
var $testVar10 400
setMeta $testVar10 key1 "value1"
setMeta $testVar10 key2 "value2"
setMeta $testVar10 key3 123
getMeta $testVar10
$allMeta10 = $
test.assertEqual $allMeta10.key1 "value1" "Multiple metadata - key1 failed"
test.assertEqual $allMeta10.key2 "value2" "Multiple metadata - key2 failed"
test.assertEqual $allMeta10.key3 123 "Multiple metadata - key3 failed"
