# Loop Tests
# Tests for for loops, break statements, and continue statements

log "=== Loop Tests ==="

# Test 1: Basic for loop
log "Test 1: Basic for loop"
for $i in range 1 5
  log "Test 1 - Loop iteration:" $i
endfor

# Test 2: Nested for loop
log "Test 2: Nested for loop"
for $i in range 1 3
  for $j in range 1 2
    log "Test 2 - Nested loop:" $i $j
  endfor
endfor

# Test 3: For loop with array
log "Test 3: For loop with array"
$numbers = range 10 12
for $num in $numbers
  log "Test 3 - Number:" $num
endfor

# Test 4: For loop inside if
log "Test 4: For loop inside if"
$count = 3
if $count > 0
  for $i in range 1 $count
    log "Test 4 - Conditional loop:" $i
  endfor
endif

# Test 5: If inside for loop
log "Test 5: If inside for loop"
for $i in range 1 5
  if $i > 3
    log "Test 5 - Greater than 3:" $i
  endif
endfor

# Test 6: Break statement in for loops
log "Test 6: Break statement"
$breakTest = 0
for $i in range 1 10
  if $i == 5
    break
  endif
  set $breakTest $i
endfor
test.assertEqual $breakTest 4 "Basic break statement failed"

# Test 7: Break in nested loops (should only break inner loop)
log "Test 7: Break in nested loops"
$outerCount = 0
$innerCount = 0
for $i in range 1 3
  set $outerCount $i
  for $j in range 1 5
    if $j == 3
      break
    endif
    set $innerCount $j
  endfor
endfor
test.assertEqual $outerCount 3 "Break in nested loop - outer loop failed"
test.assertEqual $innerCount 2 "Break in nested loop - inner loop failed"

# Test 8: Break with condition
log "Test 8: Break with condition"
$found = false
for $i in range 1 10
  if $i == 7
    set $found true
    break
  endif
endfor
test.assertEqual $found true "Break with condition failed"

# Test 9: Break early in loop
log "Test 9: Break early in loop"
$earlyBreak = 0
for $i in range 1 10
  if $i == 1
    break
  endif
  set $earlyBreak $i
endfor
test.assertEqual $earlyBreak 0 "Early break failed"

# Test 10: Break preserves last value
log "Test 10: Break preserves last value"
clear
do
  for $i in range 1 5
    if $i == 3
      break
    endif
  endfor
  test.assertEqual $ 3 "Break preserves last value failed"
enddo

# Test 11: Continue statement in for loops
log "Test 11: Continue statement"
$continueTest = 0
for $i in range 1 10
  if $i == 5
    continue
  endif
  set $continueTest $i
endfor
test.assertEqual $continueTest 10 "Basic continue statement failed"

# Test 12: Continue with condition
log "Test 12: Continue with condition"
$continueSum = 0
for $i in range 1 10
  if $i % 2 == 0
    continue
  endif
  math.add $continueSum $i
  $continueSum = $
endfor
test.assertEqual $continueSum 25 "Continue with condition failed (should sum odd numbers 1+3+5+7+9=25)"

# Test 13: Continue in nested loops (should only continue inner loop)
log "Test 13: Continue in nested loops"
$outerContinue = 0
$innerContinue = 0
for $i in range 1 3
  set $outerContinue $i
  for $j in range 1 5
    if $j == 3
      continue
    endif
    set $innerContinue $j
  endfor
endfor
test.assertEqual $outerContinue 3 "Continue in nested loop - outer loop failed"
test.assertEqual $innerContinue 5 "Continue in nested loop - inner loop failed"

# Test 14: Continue early in loop
log "Test 14: Continue early in loop"
$earlyContinue = 0
for $i in range 1 10
  if $i <= 3
    continue
  endif
  set $earlyContinue $i
endfor
test.assertEqual $earlyContinue 10 "Early continue failed"

# Test 15: Continue preserves last value
log "Test 15: Continue preserves last value"
clear
do
  for $i in range 1 5
    if $i == 5
      continue
    endif
    $temp = $i
  endfor
  test.assertEqual $temp 4 "Continue preserves last value failed"
enddo

# Test 16: Continue skips remaining statements
log "Test 16: Continue skips remaining statements"
$skipTest = 0
$shouldSkip = true
for $i in range 1 5
  if $i == 3
    set $shouldSkip false
    continue  # This skips the "if not $shouldSkip" check below for iteration 3
  endif
  if not $shouldSkip
    set $skipTest $i
  endif
endfor
# After loop: $skipTest should be 5 (from iterations 4 and 5, since iteration 3's continue skipped the check)
test.assertEqual $skipTest 5 "Continue should skip remaining statements failed"

# Test 17: Continue with multiple conditions
log "Test 17: Continue with multiple conditions"
$count = 0
$firstValue = 0
$lastValue = 0
for $i in range 1 10
  if $i < 3
    continue
  endif
  if $i > 7
    continue
  endif
  if $count == 0
    set $firstValue $i
  endif
  set $lastValue $i
  math.add $count 1
  set $count $
endfor
test.assertEqual $firstValue 3 "Continue with multiple conditions - first value failed"
test.assertEqual $lastValue 7 "Continue with multiple conditions - last value failed"
test.assertEqual $count 5 "Continue with multiple conditions - count failed"

# Test 18: Range with step parameter
log "Test 11: Range with step parameter"
range 0 5 1
$range1 = $
test.assertEqual $range1[0] 0 "Range with step 1 - first element failed"
test.assertEqual $range1[5] 5 "Range with step 1 - last element failed"
clear
do
  array.length $range1
  test.assertEqual $ 6 "Range with step 1 - length failed"
enddo

range 0 10 2
$range2 = $
test.assertEqual $range2[0] 0 "Range with step 2 - first element failed"
test.assertEqual $range2[1] 2 "Range with step 2 - second element failed"
test.assertEqual $range2[5] 10 "Range with step 2 - last element failed"
clear
do
  array.length $range2
  test.assertEqual $ 6 "Range with step 2 - length failed"
enddo

range 5 0 -1
$range3 = $
test.assertEqual $range3[0] 5 "Range with step -1 - first element failed"
test.assertEqual $range3[5] 0 "Range with step -1 - last element failed"
clear
do
  array.length $range3
  test.assertEqual $ 6 "Range with step -1 - length failed"
enddo

log "=== Loop Tests Complete ==="
