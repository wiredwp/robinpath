[
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 0,
      "startCol": 4,
      "endRow": 0,
      "endCol": 16
    },
    "name": "chunk",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 8
      }
    ]
  },
  {
    "type": "comment",
    "lastValue": null,
    "comments": [
      {
        "text": "Subexpression Tests\nTests for subexpression functionality $( )",
        "codePos": {
          "startRow": 1,
          "startCol": 0,
          "endRow": 2,
          "endCol": 43
        },
        "inline": false
      }
    ],
    "lineNumber": 1
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 4,
      "startCol": 0,
      "endRow": 4,
      "endCol": 33
    },
    "trailingBlankLines": 1,
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "=== Subexpression Tests ==="
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 7,
      "startCol": 0,
      "endRow": 7,
      "endCol": 33
    },
    "comments": [
      {
        "text": "Test 1: Basic single-line subexpression",
        "codePos": {
          "startRow": 6,
          "startCol": 0,
          "endRow": 6,
          "endCol": 40
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 1: Basic subexpression"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 8,
      "startCol": 0,
      "endRow": 8,
      "endCol": 24
    },
    "targetName": "test1",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 8,
        "startCol": 9,
        "endRow": 8,
        "endCol": 24
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 8,
                "startCol": 11,
                "endRow": 8,
                "endCol": 23
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 5
                },
                {
                  "type": "number",
                  "value": 3
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 8,
            "startCol": 9,
            "endRow": 8,
            "endCol": 24
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 9,
      "startCol": 0,
      "endRow": 9,
      "endCol": 54
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test1",
        "path": []
      },
      {
        "type": "number",
        "value": 8
      },
      {
        "type": "string",
        "value": "Basic subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 12,
      "startCol": 0,
      "endRow": 12,
      "endCol": 51
    },
    "comments": [
      {
        "text": "Test 2: Subexpression with variable reference",
        "codePos": {
          "startRow": 11,
          "startCol": 0,
          "endRow": 11,
          "endCol": 46
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 2: Subexpression with variable reference"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 13,
      "startCol": 0,
      "endRow": 13,
      "endCol": 25
    },
    "targetName": "test2",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 13,
        "startCol": 9,
        "endRow": 13,
        "endCol": 25
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 13,
                "startCol": 11,
                "endRow": 13,
                "endCol": 24
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 10
                },
                {
                  "type": "number",
                  "value": 5
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 13,
            "startCol": 9,
            "endRow": 13,
            "endCol": 25
          }
        }
      ]
    }
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 14,
      "startCol": 0,
      "endRow": 14,
      "endCol": 34
    },
    "targetName": "test3",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 14,
        "startCol": 9,
        "endRow": 14,
        "endCol": 34
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 14,
                "startCol": 11,
                "endRow": 14,
                "endCol": 33
              },
              "name": "math.multiply",
              "module": "math",
              "args": [
                {
                  "type": "var",
                  "name": "test2",
                  "path": []
                },
                {
                  "type": "number",
                  "value": 2
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 14,
            "startCol": 9,
            "endRow": 14,
            "endCol": 34
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 15,
      "startCol": 0,
      "endRow": 15,
      "endCol": 73
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test3",
        "path": []
      },
      {
        "type": "number",
        "value": 30
      },
      {
        "type": "string",
        "value": "Subexpression with variable reference failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 18,
      "startCol": 0,
      "endRow": 18,
      "endCol": 35
    },
    "comments": [
      {
        "text": "Test 3: Nested subexpressions",
        "codePos": {
          "startRow": 17,
          "startCol": 0,
          "endRow": 17,
          "endCol": 30
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 3: Nested subexpressions"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 19,
      "startCol": 0,
      "endRow": 19,
      "endCol": 57
    },
    "targetName": "test4",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 19,
        "startCol": 9,
        "endRow": 19,
        "endCol": 57
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 19,
                "startCol": 11,
                "endRow": 19,
                "endCol": 56
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "subexpression",
                  "body": [
                    {
                      "type": "command",
                      "lastValue": null,
                      "codePos": {
                        "startRow": 19,
                        "startCol": 22,
                        "endRow": 19,
                        "endCol": 39
                      },
                      "name": "math.multiply",
                      "module": "math",
                      "args": [
                        {
                          "type": "number",
                          "value": 2
                        },
                        {
                          "type": "number",
                          "value": 3
                        }
                      ]
                    }
                  ],
                  "codePos": {
                    "startRow": 19,
                    "startCol": 20,
                    "endRow": 19,
                    "endCol": 42
                  }
                },
                {
                  "type": "subexpression",
                  "body": [
                    {
                      "type": "command",
                      "lastValue": null,
                      "codePos": {
                        "startRow": 19,
                        "startCol": 43,
                        "endRow": 19,
                        "endCol": 55
                      },
                      "name": "math.add",
                      "module": "math",
                      "args": [
                        {
                          "type": "number",
                          "value": 1
                        },
                        {
                          "type": "number",
                          "value": 1
                        }
                      ]
                    }
                  ],
                  "codePos": {
                    "startRow": 19,
                    "startCol": 41,
                    "endRow": 19,
                    "endCol": 56
                  }
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 19,
            "startCol": 9,
            "endRow": 19,
            "endCol": 57
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 20,
      "startCol": 0,
      "endRow": 20,
      "endCol": 55
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test4",
        "path": []
      },
      {
        "type": "number",
        "value": 8
      },
      {
        "type": "string",
        "value": "Nested subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 23,
      "startCol": 0,
      "endRow": 23,
      "endCol": 38
    },
    "comments": [
      {
        "text": "Test 4: Multi-line subexpression",
        "codePos": {
          "startRow": 22,
          "startCol": 0,
          "endRow": 22,
          "endCol": 33
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 4: Multi-line subexpression"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 24,
      "startCol": 0,
      "endRow": 26,
      "endCol": 1
    },
    "targetName": "test5",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 24,
        "startCol": 9,
        "endRow": 26,
        "endCol": 1
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 25,
                "startCol": 2,
                "endRow": 25,
                "endCol": 16
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 10
                },
                {
                  "type": "number",
                  "value": 20
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 24,
            "startCol": 9,
            "endRow": 26,
            "endCol": 1
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 27,
      "startCol": 0,
      "endRow": 27,
      "endCol": 60
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test5",
        "path": []
      },
      {
        "type": "number",
        "value": 30
      },
      {
        "type": "string",
        "value": "Multi-line subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 30,
      "startCol": 0,
      "endRow": 30,
      "endCol": 64
    },
    "comments": [
      {
        "text": "Test 5: Multi-line subexpression with nested subexpression",
        "codePos": {
          "startRow": 29,
          "startCol": 0,
          "endRow": 29,
          "endCol": 59
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 5: Multi-line subexpression with nested subexpression"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 33,
      "startCol": 0,
      "endRow": 35,
      "endCol": 1
    },
    "comments": [
      {
        "text": "Note: $test2 is 15 at this point. The nested subexpression $(set $test2 1)\nsets $test2 to 1 and returns 1, so math.multiply 15 1 = 15",
        "codePos": {
          "startRow": 31,
          "startCol": 0,
          "endRow": 32,
          "endCol": 59
        },
        "inline": false
      }
    ],
    "targetName": "test6",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 33,
        "startCol": 9,
        "endRow": 35,
        "endCol": 1
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 34,
                "startCol": 2,
                "endRow": 35,
                "endCol": 0
              },
              "name": "math.multiply",
              "module": "math",
              "args": [
                {
                  "type": "var",
                  "name": "test2",
                  "path": []
                },
                {
                  "type": "subexpression",
                  "body": [
                    {
                      "type": "command",
                      "lastValue": null,
                      "codePos": {
                        "startRow": 34,
                        "startCol": 25,
                        "endRow": 34,
                        "endCol": 37
                      },
                      "name": "set",
                      "module": null,
                      "args": [
                        {
                          "type": "var",
                          "name": "test2",
                          "path": []
                        },
                        {
                          "type": "number",
                          "value": 1
                        }
                      ]
                    }
                  ],
                  "codePos": {
                    "startRow": 34,
                    "startCol": 23,
                    "endRow": 34,
                    "endCol": 38
                  }
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 33,
            "startCol": 9,
            "endRow": 35,
            "endCol": 1
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 36,
      "startCol": 0,
      "endRow": 36,
      "endCol": 114
    },
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test6",
        "path": []
      },
      {
        "type": "number",
        "value": 15
      },
      {
        "type": "string",
        "value": "Multi-line subexpression with nested subexpression failed (math.multiply 15 null = 0)"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 37,
      "startCol": 0,
      "endRow": 37,
      "endCol": 62
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test2",
        "path": []
      },
      {
        "type": "number",
        "value": 1
      },
      {
        "type": "string",
        "value": "Nested set in subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 40,
      "startCol": 0,
      "endRow": 40,
      "endCol": 46
    },
    "comments": [
      {
        "text": "Test 6: Complex multi-line subexpression",
        "codePos": {
          "startRow": 39,
          "startCol": 0,
          "endRow": 39,
          "endCol": 41
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 6: Complex multi-line subexpression"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 41,
      "startCol": 0,
      "endRow": 44,
      "endCol": 1
    },
    "targetName": "test7",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 41,
        "startCol": 9,
        "endRow": 44,
        "endCol": 1
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 42,
                "startCol": 2,
                "endRow": 42,
                "endCol": 14
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 5
                },
                {
                  "type": "number",
                  "value": 5
                }
              ]
            },
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 43,
                "startCol": 2,
                "endRow": 43,
                "endCol": 19
              },
              "name": "math.multiply",
              "module": "math",
              "args": [
                {
                  "type": "lastValue"
                },
                {
                  "type": "number",
                  "value": 3
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 41,
            "startCol": 9,
            "endRow": 44,
            "endCol": 1
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 45,
      "startCol": 0,
      "endRow": 45,
      "endCol": 68
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test7",
        "path": []
      },
      {
        "type": "number",
        "value": 30
      },
      {
        "type": "string",
        "value": "Complex multi-line subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 48,
      "startCol": 0,
      "endRow": 48,
      "endCol": 44
    },
    "comments": [
      {
        "text": "Test 7: Subexpression in function call",
        "codePos": {
          "startRow": 47,
          "startCol": 0,
          "endRow": 47,
          "endCol": 39
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 7: Subexpression in function call"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 49,
      "startCol": 0,
      "endRow": 50,
      "endCol": 1
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "do",
    "lastValue": null,
    "codePos": {
      "startRow": 50,
      "startCol": 0,
      "endRow": 53,
      "endCol": 4
    },
    "trailingBlankLines": 1,
    "body": [
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 51,
          "startCol": 2,
          "endRow": 52,
          "endCol": 5
        },
        "name": "math.add",
        "module": "math",
        "args": [
          {
            "type": "subexpression",
            "body": [
              {
                "type": "command",
                "lastValue": null,
                "codePos": {
                  "startRow": 51,
                  "startCol": 13,
                  "endRow": 51,
                  "endCol": 30
                },
                "name": "math.multiply",
                "module": "math",
                "args": [
                  {
                    "type": "number",
                    "value": 2
                  },
                  {
                    "type": "number",
                    "value": 5
                  }
                ]
              }
            ],
            "codePos": {
              "startRow": 51,
              "startCol": 11,
              "endRow": 51,
              "endCol": 33
            }
          },
          {
            "type": "subexpression",
            "body": [
              {
                "type": "command",
                "lastValue": null,
                "codePos": {
                  "startRow": 51,
                  "startCol": 34,
                  "endRow": 51,
                  "endCol": 46
                },
                "name": "math.add",
                "module": "math",
                "args": [
                  {
                    "type": "number",
                    "value": 3
                  },
                  {
                    "type": "number",
                    "value": 2
                  }
                ]
              }
            ],
            "codePos": {
              "startRow": 51,
              "startCol": 32,
              "endRow": 51,
              "endCol": 47
            }
          }
        ]
      },
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 52,
          "startCol": 2,
          "endRow": 52,
          "endCol": 63
        },
        "name": "test.assertEqual",
        "module": "test",
        "args": [
          {
            "type": "lastValue"
          },
          {
            "type": "number",
            "value": 15
          },
          {
            "type": "string",
            "value": "Subexpression in function call failed"
          }
        ]
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 56,
      "startCol": 0,
      "endRow": 56,
      "endCol": 42
    },
    "comments": [
      {
        "text": "Test 8: Subexpression in conditional",
        "codePos": {
          "startRow": 55,
          "startCol": 0,
          "endRow": 55,
          "endCol": 37
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 8: Subexpression in conditional"
      }
    ]
  },
  {
    "type": "ifBlock",
    "lastValue": null,
    "codePos": {
      "startRow": 57,
      "startCol": 0,
      "endRow": 61,
      "endCol": 4
    },
    "conditionExpr": {
      "type": "binary",
      "operator": "==",
      "left": {
        "type": "subexpression",
        "body": [
          {
            "type": "command",
            "name": "math.add",
            "args": [
              {
                "type": "number",
                "value": 5
              },
              {
                "type": "number",
                "value": 5
              }
            ],
            "codePos": {
              "startRow": 57,
              "startCol": 5,
              "endRow": 57,
              "endCol": 17
            }
          }
        ],
        "codePos": {
          "startRow": 57,
          "startCol": 3,
          "endRow": 57,
          "endCol": 20
        }
      },
      "right": {
        "type": "number",
        "value": 10,
        "codePos": {
          "startRow": 57,
          "startCol": 22,
          "endRow": 57,
          "endCol": 23
        }
      },
      "codePos": {
        "startRow": 57,
        "startCol": 3,
        "endRow": 57,
        "endCol": 20
      }
    },
    "thenBranch": [
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 58,
          "startCol": 2,
          "endRow": 58,
          "endCol": 18
        },
        "targetName": "test8",
        "targetPath": [],
        "literalValue": "passed",
        "literalValueType": "string"
      }
    ],
    "elseBranch": [
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 60,
          "startCol": 2,
          "endRow": 60,
          "endCol": 18
        },
        "targetName": "test8",
        "targetPath": [],
        "literalValue": "failed",
        "literalValueType": "string"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 62,
      "startCol": 0,
      "endRow": 62,
      "endCol": 70
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test8",
        "path": []
      },
      {
        "type": "string",
        "value": "passed"
      },
      {
        "type": "string",
        "value": "Subexpression in conditional failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 65,
      "startCol": 0,
      "endRow": 65,
      "endCol": 50
    },
    "comments": [
      {
        "text": "Test 9: Subexpression with string operations",
        "codePos": {
          "startRow": 64,
          "startCol": 0,
          "endRow": 64,
          "endCol": 45
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 9: Subexpression with string operations"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 66,
      "startCol": 0,
      "endRow": 66,
      "endCol": 45
    },
    "targetName": "test9",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 66,
        "startCol": 9,
        "endRow": 66,
        "endCol": 45
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 66,
                "startCol": 11,
                "endRow": 66,
                "endCol": 44
              },
              "name": "string.concat",
              "module": "string",
              "args": [
                {
                  "type": "string",
                  "value": "hello"
                },
                {
                  "type": "string",
                  "value": " "
                },
                {
                  "type": "string",
                  "value": "world"
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 66,
            "startCol": 9,
            "endRow": 66,
            "endCol": 45
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 67,
      "startCol": 0,
      "endRow": 67,
      "endCol": 83
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test9",
        "path": []
      },
      {
        "type": "string",
        "value": "hello world"
      },
      {
        "type": "string",
        "value": "Subexpression with string operations failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 70,
      "startCol": 0,
      "endRow": 70,
      "endCol": 50
    },
    "comments": [
      {
        "text": "Test 10: Subexpression with array operations",
        "codePos": {
          "startRow": 69,
          "startCol": 0,
          "endRow": 69,
          "endCol": 45
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 10: Subexpression with array operations"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 71,
      "startCol": 0,
      "endRow": 71,
      "endCol": 31
    },
    "targetName": "test10",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 71,
        "startCol": 10,
        "endRow": 71,
        "endCol": 31
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 71,
                "startCol": 12,
                "endRow": 71,
                "endCol": 30
              },
              "name": "array.create",
              "module": "array",
              "args": [
                {
                  "type": "number",
                  "value": 1
                },
                {
                  "type": "number",
                  "value": 2
                },
                {
                  "type": "number",
                  "value": 3
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 71,
            "startCol": 10,
            "endRow": 71,
            "endCol": 31
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 72,
      "startCol": 0,
      "endRow": 73,
      "endCol": 1
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "do",
    "lastValue": null,
    "codePos": {
      "startRow": 73,
      "startCol": 0,
      "endRow": 76,
      "endCol": 4
    },
    "trailingBlankLines": 1,
    "body": [
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 74,
          "startCol": 2,
          "endRow": 74,
          "endCol": 22
        },
        "name": "array.length",
        "module": "array",
        "args": [
          {
            "type": "var",
            "name": "test10",
            "path": []
          }
        ]
      },
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 75,
          "startCol": 2,
          "endRow": 75,
          "endCol": 67
        },
        "name": "test.assertEqual",
        "module": "test",
        "args": [
          {
            "type": "lastValue"
          },
          {
            "type": "number",
            "value": 3
          },
          {
            "type": "string",
            "value": "Subexpression with array operations failed"
          }
        ]
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 79,
      "startCol": 0,
      "endRow": 79,
      "endCol": 43
    },
    "comments": [
      {
        "text": "Test 11: Deeply nested subexpressions",
        "codePos": {
          "startRow": 78,
          "startCol": 0,
          "endRow": 78,
          "endCol": 38
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 11: Deeply nested subexpressions"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 80,
      "startCol": 0,
      "endRow": 80,
      "endCol": 72
    },
    "targetName": "test11",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 80,
        "startCol": 10,
        "endRow": 80,
        "endCol": 72
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 80,
                "startCol": 12,
                "endRow": 80,
                "endCol": 71
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "subexpression",
                  "body": [
                    {
                      "type": "command",
                      "lastValue": null,
                      "codePos": {
                        "startRow": 80,
                        "startCol": 23,
                        "endRow": 80,
                        "endCol": 54
                      },
                      "name": "math.multiply",
                      "module": "math",
                      "args": [
                        {
                          "type": "subexpression",
                          "body": [
                            {
                              "type": "command",
                              "lastValue": null,
                              "codePos": {
                                "startRow": 80,
                                "startCol": 39,
                                "endRow": 80,
                                "endCol": 51
                              },
                              "name": "math.add",
                              "module": "math",
                              "args": [
                                {
                                  "type": "number",
                                  "value": 1
                                },
                                {
                                  "type": "number",
                                  "value": 1
                                }
                              ]
                            }
                          ],
                          "codePos": {
                            "startRow": 80,
                            "startCol": 37,
                            "endRow": 80,
                            "endCol": 53
                          }
                        },
                        {
                          "type": "number",
                          "value": 2
                        }
                      ]
                    }
                  ],
                  "codePos": {
                    "startRow": 80,
                    "startCol": 21,
                    "endRow": 80,
                    "endCol": 57
                  }
                },
                {
                  "type": "subexpression",
                  "body": [
                    {
                      "type": "command",
                      "lastValue": null,
                      "codePos": {
                        "startRow": 80,
                        "startCol": 58,
                        "endRow": 80,
                        "endCol": 70
                      },
                      "name": "math.add",
                      "module": "math",
                      "args": [
                        {
                          "type": "number",
                          "value": 1
                        },
                        {
                          "type": "number",
                          "value": 1
                        }
                      ]
                    }
                  ],
                  "codePos": {
                    "startRow": 80,
                    "startCol": 56,
                    "endRow": 80,
                    "endCol": 71
                  }
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 80,
            "startCol": 10,
            "endRow": 80,
            "endCol": 72
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 81,
      "startCol": 0,
      "endRow": 81,
      "endCol": 63
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test11",
        "path": []
      },
      {
        "type": "number",
        "value": 6
      },
      {
        "type": "string",
        "value": "Deeply nested subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 84,
      "startCol": 0,
      "endRow": 84,
      "endCol": 48
    },
    "comments": [
      {
        "text": "Test 12: Subexpression with return value",
        "codePos": {
          "startRow": 83,
          "startCol": 0,
          "endRow": 83,
          "endCol": 41
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 12: Subexpression in return statement"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 85,
      "startCol": 0,
      "endRow": 87,
      "endCol": 5
    },
    "name": "test_subexpr_return",
    "paramNames": [],
    "body": [
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 86,
          "startCol": 2,
          "endRow": 86,
          "endCol": 26
        },
        "value": {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 86,
                "startCol": 11,
                "endRow": 86,
                "endCol": 25
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 10
                },
                {
                  "type": "number",
                  "value": 20
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 86,
            "startCol": 9,
            "endRow": 86,
            "endCol": 26
          }
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 88,
      "startCol": 0,
      "endRow": 89,
      "endCol": 1
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "do",
    "lastValue": null,
    "codePos": {
      "startRow": 89,
      "startCol": 0,
      "endRow": 92,
      "endCol": 4
    },
    "trailingBlankLines": 1,
    "body": [
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 90,
          "startCol": 2,
          "endRow": 91,
          "endCol": 5
        },
        "name": "test_subexpr_return",
        "module": null,
        "args": []
      },
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 91,
          "startCol": 2,
          "endRow": 91,
          "endCol": 66
        },
        "name": "test.assertEqual",
        "module": "test",
        "args": [
          {
            "type": "lastValue"
          },
          {
            "type": "number",
            "value": 30
          },
          {
            "type": "string",
            "value": "Subexpression in return statement failed"
          }
        ]
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 95,
      "startCol": 0,
      "endRow": 95,
      "endCol": 64
    },
    "comments": [
      {
        "text": "Test 13: Multi-line subexpression with multiple statements",
        "codePos": {
          "startRow": 94,
          "startCol": 0,
          "endRow": 94,
          "endCol": 59
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 13: Multi-line subexpression with multiple statements"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 96,
      "startCol": 0,
      "endRow": 100,
      "endCol": 1
    },
    "targetName": "test12",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 96,
        "startCol": 10,
        "endRow": 100,
        "endCol": 1
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 97,
                "startCol": 2,
                "endRow": 97,
                "endCol": 14
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "number",
                  "value": 1
                },
                {
                  "type": "number",
                  "value": 2
                }
              ]
            },
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 98,
                "startCol": 2,
                "endRow": 98,
                "endCol": 19
              },
              "name": "math.multiply",
              "module": "math",
              "args": [
                {
                  "type": "lastValue"
                },
                {
                  "type": "number",
                  "value": 2
                }
              ]
            },
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 99,
                "startCol": 2,
                "endRow": 99,
                "endCol": 14
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "lastValue"
                },
                {
                  "type": "number",
                  "value": 1
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 96,
            "startCol": 10,
            "endRow": 100,
            "endCol": 1
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 101,
      "startCol": 0,
      "endRow": 101,
      "endCol": 85
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test12",
        "path": []
      },
      {
        "type": "number",
        "value": 7
      },
      {
        "type": "string",
        "value": "Multi-line subexpression with multiple statements failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 104,
      "startCol": 0,
      "endRow": 104,
      "endCol": 53
    },
    "comments": [
      {
        "text": "Test 14: Subexpression with variable assignment inside (modifies parent do)",
        "codePos": {
          "startRow": 103,
          "startCol": 0,
          "endRow": 103,
          "endCol": 76
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 14: Subexpression with variable assignment"
      }
    ]
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 105,
      "startCol": 0,
      "endRow": 105,
      "endCol": 12
    },
    "comments": [
      {
        "text": "Set initial value in parent do",
        "codePos": {
          "startRow": 105,
          "startCol": 15,
          "endRow": 105,
          "endCol": 46
        },
        "inline": true
      }
    ],
    "targetName": "testVar",
    "targetPath": [],
    "literalValue": 10,
    "literalValueType": "number"
  },
  {
    "type": "assignment",
    "lastValue": null,
    "codePos": {
      "startRow": 106,
      "startCol": 0,
      "endRow": 109,
      "endCol": 1
    },
    "targetName": "test13",
    "targetPath": [],
    "command": {
      "type": "command",
      "lastValue": null,
      "codePos": {
        "startRow": 106,
        "startCol": 10,
        "endRow": 109,
        "endCol": 1
      },
      "name": "_subexpr",
      "module": null,
      "args": [
        {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 107,
                "startCol": 2,
                "endRow": 107,
                "endCol": 59
              },
              "name": "set",
              "module": null,
              "args": [
                {
                  "type": "var",
                  "name": "testVar",
                  "path": []
                },
                {
                  "type": "number",
                  "value": 42
                }
              ]
            },
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 108,
                "startCol": 2,
                "endRow": 108,
                "endCol": 21
              },
              "name": "math.add",
              "module": "math",
              "args": [
                {
                  "type": "var",
                  "name": "testVar",
                  "path": []
                },
                {
                  "type": "number",
                  "value": 8
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 106,
            "startCol": 10,
            "endRow": 109,
            "endCol": 1
          }
        }
      ]
    }
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 110,
      "startCol": 0,
      "endRow": 110,
      "endCol": 75
    },
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "test13",
        "path": []
      },
      {
        "type": "number",
        "value": 50
      },
      {
        "type": "string",
        "value": "Subexpression with variable assignment failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 111,
      "startCol": 0,
      "endRow": 111,
      "endCol": 91
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "var",
        "name": "testVar",
        "path": []
      },
      {
        "type": "number",
        "value": 42
      },
      {
        "type": "string",
        "value": "Variable assignment in subexpression should modify parent do"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 114,
      "startCol": 0,
      "endRow": 114,
      "endCol": 52
    },
    "comments": [
      {
        "text": "Test 15: Def function with $1 in subexpression",
        "codePos": {
          "startRow": 113,
          "startCol": 0,
          "endRow": 113,
          "endCol": 47
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 15: Def function with $1 in subexpression"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 115,
      "startCol": 0,
      "endRow": 117,
      "endCol": 5
    },
    "name": "add_with_subexpr",
    "paramNames": [],
    "body": [
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 116,
          "startCol": 2,
          "endRow": 116,
          "endCol": 20
        },
        "value": {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 116,
                "startCol": 11,
                "endRow": 116,
                "endCol": 19
              },
              "name": "add",
              "module": null,
              "args": [
                {
                  "type": "var",
                  "name": "1",
                  "path": []
                },
                {
                  "type": "number",
                  "value": 2
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 116,
            "startCol": 9,
            "endRow": 116,
            "endCol": 20
          }
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 118,
      "startCol": 0,
      "endRow": 119,
      "endCol": 15
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 119,
      "startCol": 0,
      "endRow": 119,
      "endCol": 18
    },
    "name": "add_with_subexpr",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 5
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 120,
      "startCol": 0,
      "endRow": 120,
      "endCol": 67
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 7
      },
      {
        "type": "string",
        "value": "def function with $1 in subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 123,
      "startCol": 0,
      "endRow": 123,
      "endCol": 59
    },
    "comments": [
      {
        "text": "Test 16: Def function with $1 and $2 in subexpression",
        "codePos": {
          "startRow": 122,
          "startCol": 0,
          "endRow": 122,
          "endCol": 54
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 16: Def function with $1 and $2 in subexpression"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 124,
      "startCol": 0,
      "endRow": 126,
      "endCol": 5
    },
    "name": "add_two_params",
    "paramNames": [],
    "body": [
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 125,
          "startCol": 2,
          "endRow": 125,
          "endCol": 21
        },
        "value": {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 125,
                "startCol": 11,
                "endRow": 125,
                "endCol": 20
              },
              "name": "add",
              "module": null,
              "args": [
                {
                  "type": "var",
                  "name": "1",
                  "path": []
                },
                {
                  "type": "var",
                  "name": "2",
                  "path": []
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 125,
            "startCol": 9,
            "endRow": 125,
            "endCol": 21
          }
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 127,
      "startCol": 0,
      "endRow": 128,
      "endCol": 13
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 128,
      "startCol": 0,
      "endRow": 128,
      "endCol": 20
    },
    "name": "add_two_params",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 10
      },
      {
        "type": "number",
        "value": 20
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 129,
      "startCol": 0,
      "endRow": 129,
      "endCol": 75
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 30
      },
      {
        "type": "string",
        "value": "def function with $1 and $2 in subexpression failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 132,
      "startCol": 0,
      "endRow": 132,
      "endCol": 70
    },
    "comments": [
      {
        "text": "Test 17: Def function with positional params in nested subexpression",
        "codePos": {
          "startRow": 131,
          "startCol": 0,
          "endRow": 131,
          "endCol": 69
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 17: Def function with nested subexpressions using $1 and $2"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 133,
      "startCol": 0,
      "endRow": 136,
      "endCol": 5
    },
    "name": "nested_subexpr_test",
    "paramNames": [],
    "body": [
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 134,
          "startCol": 2,
          "endRow": 134,
          "endCol": 53
        },
        "targetName": "result",
        "targetPath": [],
        "command": {
          "type": "command",
          "lastValue": null,
          "codePos": {
            "startRow": 134,
            "startCol": 12,
            "endRow": 134,
            "endCol": 53
          },
          "name": "_subexpr",
          "module": null,
          "args": [
            {
              "type": "subexpression",
              "body": [
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 134,
                    "startCol": 14,
                    "endRow": 134,
                    "endCol": 52
                  },
                  "name": "math.multiply",
                  "module": "math",
                  "args": [
                    {
                      "type": "subexpression",
                      "body": [
                        {
                          "type": "command",
                          "lastValue": null,
                          "codePos": {
                            "startRow": 134,
                            "startCol": 30,
                            "endRow": 134,
                            "endCol": 38
                          },
                          "name": "add",
                          "module": null,
                          "args": [
                            {
                              "type": "var",
                              "name": "1",
                              "path": []
                            },
                            {
                              "type": "number",
                              "value": 5
                            }
                          ]
                        }
                      ],
                      "codePos": {
                        "startRow": 134,
                        "startCol": 28,
                        "endRow": 134,
                        "endCol": 41
                      }
                    },
                    {
                      "type": "subexpression",
                      "body": [
                        {
                          "type": "command",
                          "lastValue": null,
                          "codePos": {
                            "startRow": 134,
                            "startCol": 42,
                            "endRow": 134,
                            "endCol": 51
                          },
                          "name": "add",
                          "module": null,
                          "args": [
                            {
                              "type": "var",
                              "name": "2",
                              "path": []
                            },
                            {
                              "type": "number",
                              "value": 10
                            }
                          ]
                        }
                      ],
                      "codePos": {
                        "startRow": 134,
                        "startCol": 40,
                        "endRow": 134,
                        "endCol": 52
                      }
                    }
                  ]
                }
              ],
              "codePos": {
                "startRow": 134,
                "startCol": 12,
                "endRow": 134,
                "endCol": 53
              }
            }
          ]
        }
      },
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 135,
          "startCol": 2,
          "endRow": 135,
          "endCol": 16
        },
        "value": {
          "type": "var",
          "name": "result",
          "path": []
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 137,
      "startCol": 0,
      "endRow": 138,
      "endCol": 18
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 138,
      "startCol": 0,
      "endRow": 138,
      "endCol": 23
    },
    "name": "nested_subexpr_test",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 2
      },
      {
        "type": "number",
        "value": 3
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 139,
      "startCol": 0,
      "endRow": 139,
      "endCol": 114
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 91
      },
      {
        "type": "string",
        "value": "def function with nested subexpressions using $1 and $2 failed (should be (2+5)*(3+10)=91)"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 142,
      "startCol": 0,
      "endRow": 142,
      "endCol": 63
    },
    "comments": [
      {
        "text": "Test 18: Def function with $1 in multi-line subexpression",
        "codePos": {
          "startRow": 141,
          "startCol": 0,
          "endRow": 141,
          "endCol": 58
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 18: Def function with $1 in multi-line subexpression"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 143,
      "startCol": 0,
      "endRow": 149,
      "endCol": 5
    },
    "name": "multi_line_subexpr",
    "paramNames": [],
    "body": [
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 144,
          "startCol": 2,
          "endRow": 147,
          "endCol": 3
        },
        "targetName": "result",
        "targetPath": [],
        "command": {
          "type": "command",
          "lastValue": null,
          "codePos": {
            "startRow": 144,
            "startCol": 12,
            "endRow": 147,
            "endCol": 3
          },
          "name": "_subexpr",
          "module": null,
          "args": [
            {
              "type": "subexpression",
              "body": [
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 145,
                    "startCol": 4,
                    "endRow": 145,
                    "endCol": 13
                  },
                  "name": "add",
                  "module": null,
                  "args": [
                    {
                      "type": "var",
                      "name": "1",
                      "path": []
                    },
                    {
                      "type": "number",
                      "value": 10
                    }
                  ]
                },
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 146,
                    "startCol": 4,
                    "endRow": 146,
                    "endCol": 21
                  },
                  "name": "math.multiply",
                  "module": "math",
                  "args": [
                    {
                      "type": "lastValue"
                    },
                    {
                      "type": "number",
                      "value": 2
                    }
                  ]
                }
              ],
              "codePos": {
                "startRow": 144,
                "startCol": 12,
                "endRow": 147,
                "endCol": 3
              }
            }
          ]
        }
      },
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 148,
          "startCol": 2,
          "endRow": 148,
          "endCol": 16
        },
        "value": {
          "type": "var",
          "name": "result",
          "path": []
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 150,
      "startCol": 0,
      "endRow": 151,
      "endCol": 17
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 151,
      "startCol": 0,
      "endRow": 151,
      "endCol": 20
    },
    "name": "multi_line_subexpr",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 5
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 152,
      "startCol": 0,
      "endRow": 152,
      "endCol": 103
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 30
      },
      {
        "type": "string",
        "value": "def function with $1 in multi-line subexpression failed (should be (5+10)*2=30)"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 155,
      "startCol": 0,
      "endRow": 155,
      "endCol": 64
    },
    "comments": [
      {
        "text": "Test 19: Def function with multiple positional params in subexpression",
        "codePos": {
          "startRow": 154,
          "startCol": 0,
          "endRow": 154,
          "endCol": 71
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 19: Def function summing $1, $2, $3 in subexpressions"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 156,
      "startCol": 0,
      "endRow": 162,
      "endCol": 5
    },
    "name": "sum_all_params",
    "paramNames": [],
    "body": [
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 157,
          "startCol": 2,
          "endRow": 157,
          "endCol": 9
        },
        "targetName": "sum",
        "targetPath": [],
        "literalValue": 0,
        "literalValueType": "number"
      },
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 158,
          "startCol": 2,
          "endRow": 158,
          "endCol": 23
        },
        "targetName": "sum",
        "targetPath": [],
        "command": {
          "type": "command",
          "lastValue": null,
          "codePos": {
            "startRow": 158,
            "startCol": 9,
            "endRow": 158,
            "endCol": 23
          },
          "name": "_subexpr",
          "module": null,
          "args": [
            {
              "type": "subexpression",
              "body": [
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 158,
                    "startCol": 11,
                    "endRow": 158,
                    "endCol": 22
                  },
                  "name": "add",
                  "module": null,
                  "args": [
                    {
                      "type": "var",
                      "name": "sum",
                      "path": []
                    },
                    {
                      "type": "var",
                      "name": "1",
                      "path": []
                    }
                  ]
                }
              ],
              "codePos": {
                "startRow": 158,
                "startCol": 9,
                "endRow": 158,
                "endCol": 23
              }
            }
          ]
        }
      },
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 159,
          "startCol": 2,
          "endRow": 159,
          "endCol": 23
        },
        "targetName": "sum",
        "targetPath": [],
        "command": {
          "type": "command",
          "lastValue": null,
          "codePos": {
            "startRow": 159,
            "startCol": 9,
            "endRow": 159,
            "endCol": 23
          },
          "name": "_subexpr",
          "module": null,
          "args": [
            {
              "type": "subexpression",
              "body": [
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 159,
                    "startCol": 11,
                    "endRow": 159,
                    "endCol": 22
                  },
                  "name": "add",
                  "module": null,
                  "args": [
                    {
                      "type": "var",
                      "name": "sum",
                      "path": []
                    },
                    {
                      "type": "var",
                      "name": "2",
                      "path": []
                    }
                  ]
                }
              ],
              "codePos": {
                "startRow": 159,
                "startCol": 9,
                "endRow": 159,
                "endCol": 23
              }
            }
          ]
        }
      },
      {
        "type": "assignment",
        "lastValue": null,
        "codePos": {
          "startRow": 160,
          "startCol": 2,
          "endRow": 160,
          "endCol": 23
        },
        "targetName": "sum",
        "targetPath": [],
        "command": {
          "type": "command",
          "lastValue": null,
          "codePos": {
            "startRow": 160,
            "startCol": 9,
            "endRow": 160,
            "endCol": 23
          },
          "name": "_subexpr",
          "module": null,
          "args": [
            {
              "type": "subexpression",
              "body": [
                {
                  "type": "command",
                  "lastValue": null,
                  "codePos": {
                    "startRow": 160,
                    "startCol": 11,
                    "endRow": 160,
                    "endCol": 22
                  },
                  "name": "add",
                  "module": null,
                  "args": [
                    {
                      "type": "var",
                      "name": "sum",
                      "path": []
                    },
                    {
                      "type": "var",
                      "name": "3",
                      "path": []
                    }
                  ]
                }
              ],
              "codePos": {
                "startRow": 160,
                "startCol": 9,
                "endRow": 160,
                "endCol": 23
              }
            }
          ]
        }
      },
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 161,
          "startCol": 2,
          "endRow": 161,
          "endCol": 13
        },
        "value": {
          "type": "var",
          "name": "sum",
          "path": []
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 163,
      "startCol": 0,
      "endRow": 164,
      "endCol": 13
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 164,
      "startCol": 0,
      "endRow": 164,
      "endCol": 20
    },
    "name": "sum_all_params",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 1
      },
      {
        "type": "number",
        "value": 2
      },
      {
        "type": "number",
        "value": 3
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 165,
      "startCol": 0,
      "endRow": 165,
      "endCol": 79
    },
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 6
      },
      {
        "type": "string",
        "value": "def function summing $1, $2, $3 in subexpressions failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 168,
      "startCol": 0,
      "endRow": 168,
      "endCol": 47
    },
    "comments": [
      {
        "text": "Test 20: Def function with $1 used directly and in subexpression",
        "codePos": {
          "startRow": 167,
          "startCol": 0,
          "endRow": 167,
          "endCol": 65
        },
        "inline": false
      }
    ],
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "Test 20: Def function with mixed $1 usage"
      }
    ]
  },
  {
    "type": "define",
    "lastValue": null,
    "codePos": {
      "startRow": 169,
      "startCol": 0,
      "endRow": 172,
      "endCol": 5
    },
    "name": "mixed_usage",
    "paramNames": [],
    "body": [
      {
        "type": "command",
        "lastValue": null,
        "codePos": {
          "startRow": 170,
          "startCol": 2,
          "endRow": 170,
          "endCol": 12
        },
        "name": "log",
        "module": null,
        "args": [
          {
            "type": "string",
            "value": ">"
          },
          {
            "type": "var",
            "name": "1",
            "path": []
          }
        ]
      },
      {
        "type": "return",
        "lastValue": null,
        "codePos": {
          "startRow": 171,
          "startCol": 2,
          "endRow": 171,
          "endCol": 20
        },
        "value": {
          "type": "subexpression",
          "body": [
            {
              "type": "command",
              "lastValue": null,
              "codePos": {
                "startRow": 171,
                "startCol": 11,
                "endRow": 171,
                "endCol": 19
              },
              "name": "add",
              "module": null,
              "args": [
                {
                  "type": "var",
                  "name": "1",
                  "path": []
                },
                {
                  "type": "number",
                  "value": 2
                }
              ]
            }
          ],
          "codePos": {
            "startRow": 171,
            "startCol": 9,
            "endRow": 171,
            "endCol": 20
          }
        }
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 173,
      "startCol": 0,
      "endRow": 174,
      "endCol": 10
    },
    "name": "clear",
    "module": null,
    "args": []
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 174,
      "startCol": 0,
      "endRow": 174,
      "endCol": 13
    },
    "name": "mixed_usage",
    "module": null,
    "args": [
      {
        "type": "number",
        "value": 5
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 176,
      "startCol": 0,
      "endRow": 176,
      "endCol": 62
    },
    "comments": [
      {
        "text": "Last value should be 7 (from add $1 2)",
        "codePos": {
          "startRow": 175,
          "startCol": 0,
          "endRow": 175,
          "endCol": 39
        },
        "inline": false
      }
    ],
    "trailingBlankLines": 1,
    "name": "test.assertEqual",
    "module": "test",
    "args": [
      {
        "type": "lastValue"
      },
      {
        "type": "number",
        "value": 7
      },
      {
        "type": "string",
        "value": "def function with mixed $1 usage failed"
      }
    ]
  },
  {
    "type": "command",
    "lastValue": null,
    "codePos": {
      "startRow": 178,
      "startCol": 0,
      "endRow": 178,
      "endCol": 42
    },
    "name": "log",
    "module": null,
    "args": [
      {
        "type": "string",
        "value": "=== Subexpression Tests Complete ==="
      }
    ]
  }
]